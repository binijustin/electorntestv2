<html lang="en">

<head>
    <title>Sharepoint Service</title>
    <link rel="stylesheet" href="./style/bootstrap-lux.css" />
    <link rel="stylesheet" href="./style/style.css" />
</head>

<body class="bg-primary">
    <div class="header">
        <h1>Sharepoint RO Service</h1>
    </div>

    <h2 id="counter">00:00:00</h2>
    <div id="logsContainer">
        <h1>Logs</h1>
    </div>
    <ul id="logsHolder" class="list-group">
    </ul>

    <!-- Insert this line above script imports  -->
    <script>if (typeof module === 'object') { window.module = module; module = undefined; }</script>

    <!-- normal script imports etc  -->
    <script src="scripts/jquery.min.js"></script>

    <!-- Insert this line after script imports -->
    <script>if (window.module) module = window.module;</script>
    <script>
        const { remote } = require('electron')
        const { Menu, MenuItem } = remote

        const menu = new Menu()
        menu.append(new MenuItem({ label: 'MenuItem1', click() { console.log('item 1 clicked') } }))
        menu.append(new MenuItem({ type: 'separator' }))
        menu.append(new MenuItem({ label: 'MenuItem2', type: 'checkbox', checked: true }))

        window.addEventListener('contextmenu', (e) => {
            e.preventDefault()
            menu.popup({ window: remote.getCurrentWindow() })
        }, false)
    </script>
    <script>


        const counter = document.querySelector('#counter');
        const logsHolder = document.querySelector('#logsHolder')

        var fire = true;
        var seconds = 0, minutes = 0, hours = 0, t;

        function add() {
            seconds++;
            if (seconds == 1) {
                fireApi();
            }
            if (seconds >= 60) {
                seconds = 0;
                minutes++;
                fireApi();
                if (minutes >= 60) {
                    minutes = 0;
                    hours++;
                }
            }



            counter.textContent = (hours ? (hours > 9 ? hours : '0' + hours) : '00') + ':' + (minutes ? (minutes > 9 ? minutes : '0' + minutes) : '00') + ':' + (seconds > 9 ? seconds : '0' + seconds);
            timer();
        }

        function timer() {
            t = setTimeout(add, 1000);
        }

        function fireApi() {
            console.log(fire);
            if (fire === true) {
                fire = false;
                console.log("fired");
                $.ajax({
                    type: "POST",
                    url: "http://localhost:45046/api/sp/RadixOneSingleSaving"
                    //url : "http://localhost:60159/api/sp/RadixOne"
                }).done(function (data) {
                    if (data.length > 0) {
                        logsHolder.innerHTML += '<li class="list-group-item">' + data.length + '</li>'
                    }
                }).fail(function (error) {
                    if (error.status == 0) {
                        var dt = new Date();
                        logsHolder.innerHTML += '<li class="list-group-item text-danger"> Cannot connect to API ' + dt + ' </li>'
                    }
                    else {
                        logsHolder.innerHTML += '<li class="list-group-item text-danger">' + JSON.stringify(error) + '</li>'
                    }
                    console.log(error)
                }).always(function () {
                    fire = true;
                });
            }
        }


        timer();
    </script>
</body>

</html>